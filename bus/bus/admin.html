<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Smart Bus Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js for System Health -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --admin-dark: #1a202c;
            --admin-sidebar: #2d3748;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            overflow-x: hidden;
        }
        
        #sidebar {
            min-height: 100vh;
            background: var(--admin-sidebar);
            color: white;
            transition: all 0.3s;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            z-index: 1000;
        }
        
        #sidebar .sidebar-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        #sidebar ul li a {
            padding: 15px 25px;
            display: block;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        #sidebar ul li a:hover, #sidebar ul li a.active {
            color: white;
            background: rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--primary);
        }
        
        #sidebar ul li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        #content {
            margin-left: 250px;
            min-height: 100vh;
            transition: all 0.3s;
        }
        
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 999;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0 !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .admin-stats {
            text-align: center;
            padding: 20px;
        }
        
        .admin-stats-value {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .admin-stats-title {
            font-size: 14px;
            color: #6c757d;
        }
        
        .admin-table th {
            background-color: #f8f9fa;
        }
        
        .user-role {
            font-size: 0.8rem;
            padding: 0.35em 0.65em;
        }
        
        .user-active {
            background-color: #28a745;
        }
        
        .user-inactive {
            background-color: #6c757d;
        }
        
        .user-pending {
            background-color: #ffc107;
        }
        
        .system-log {
            font-family: monospace;
            font-size: 0.85rem;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .log-time {
            color: #6c757d;
            margin-right: 10px;
        }
        
        .log-info {
            color: #17a2b8;
        }
        
        .log-warning {
            color: #ffc107;
        }
        
        .log-error {
            color: #dc3545;
        }
        
        .log-success {
            color: #28a745;
        }
        
        .settings-group {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .settings-title {
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.6rem;
            padding: 0.2em 0.4em;
        }
        
        /* New styles for added features */
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .timetable-container {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .timetable-entry {
            border-left: 4px solid var(--primary);
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-radius: 0 5px 5px 0;
        }
        
        .timetable-time {
            font-weight: bold;
            color: var(--primary);
        }
        
        .timetable-route {
            font-weight: 500;
        }
        
        .timetable-status {
            font-size: 0.85rem;
            padding: 0.2em 0.6em;
            border-radius: 12px;
        }
        
        .form-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        /* Toast notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        /* Chart containers */
        .chart-container {
            position: relative;
            height: 250px;
            margin-bottom: 20px;
        }
        
        /* Permission checkbox styling */
        .permission-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        /* Log filter controls */
        .log-filters {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            #sidebar {
                width: 80px;
            }
            
            #sidebar .sidebar-header h3, #sidebar .sidebar-header p, #sidebar ul li a span {
                display: none;
            }
            
            #sidebar ul li a i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            
            #content {
                margin-left: 80px;
            }
        }
        
        @media (max-width: 768px) {
            #sidebar {
                display: none;
                width: 250px;
            }
            
            #sidebar.show {
                display: block;
                position: fixed;
                height: 100%;
                z-index: 1001;
            }
            
            #content {
                margin-left: 0;
            }
            
            .navbar-brand {
                font-size: 1.1rem;
            }
            
            .overlay {
                display: none;
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0,0,0,0.5);
                z-index: 1000;
            }
            
            .overlay.active {
                display: block;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .chart-container {
                height: 200px;
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .modal-backdrop {
            z-index: 1040;
        }
        
        .modal {
            z-index: 1050;
        }
        
        .user-form .form-label {
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="overlay" id="sidebar-overlay"></div>
    <div class="toast-container"></div>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-bus"></i> <span>SBMS Admin</span></h3>
                    <p>Admin Panel</p>
                </div>
                <ul class="nav flex-column">
                    <li>
                        <a href="#admin-dashboard" class="nav-link active" data-page="admin-dashboard">
                            <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#user-management" class="nav-link" data-page="user-management">
                            <i class="fas fa-users"></i> <span>User Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="#bus-management" class="nav-link" data-page="bus-management">
                            <i class="fas fa-bus"></i> <span>Bus Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="#route-management" class="nav-link" data-page="route-management">
                            <i class="fas fa-route"></i> <span>Route Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="#timetable-management" class="nav-link" data-page="timetable-management">
                            <i class="fas fa-clock"></i> <span>Timetable Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="#system-config" class="nav-link" data-page="system-config">
                            <i class="fas fa-cog"></i> <span>System Configuration</span>
                        </a>
                    </li>
                    <li>
                        <a href="#access-control" class="nav-link" data-page="access-control">
                            <i class="fas fa-lock"></i> <span>Access Control</span>
                        </a>
                    </li>
                    <li>
                        <a href="#audit-logs" class="nav-link" data-page="audit-logs">
                            <i class="fas fa-clipboard-list"></i> <span>Audit Logs</span>
                        </a>
                    </li>
                    <li>
                        <a href="#system-health" class="nav-link" data-page="system-health">
                            <i class="fas fa-heartbeat"></i> <span>System Health</span>
                        </a>
                    </li>
                    <li>
                        <a href="anly.htm" class="nav-link">
                            <i class="fas fa-arrow-left"></i> <span>Back to Main</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main Content -->
            <div id="content" class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="container-fluid">
                        <button class="btn btn-sm btn-primary d-md-none" type="button" id="sidebar-toggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <span class="navbar-brand mb-0 h1" id="page-title">Admin Dashboard</span>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-success me-2">
                                <i class="fas fa-circle me-1" style="font-size: 0.5rem;"></i> Admin Mode
                            </span>
                            <span id="current-time" class="text-muted me-3"></span>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-user-shield me-1"></i> Super Admin
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> My Profile</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> Settings</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="login1.htm"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>

                <!-- Admin Dashboard Page -->
                <div id="admin-dashboard" class="page active">
                    <div class="container-fluid mt-4">
                        <!-- Stats Cards -->
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="admin-stats">
                                        <i class="fas fa-users text-primary fa-2x"></i>
                                        <div class="admin-stats-value" id="total-users">42</div>
                                        <div class="admin-stats-title">Total Users</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="admin-stats">
                                        <i class="fas fa-bus text-success fa-2x"></i>
                                        <div class="admin-stats-value" id="active-buses">18</div>
                                        <div class="admin-stats-title">Active Buses</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="admin-stats">
                                        <i class="fas fa-route text-info fa-2x"></i>
                                        <div class="admin-stats-value" id="total-routes">6</div>
                                        <div class="admin-stats-title">Active Routes</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="admin-stats">
                                        <i class="fas fa-exclamation-triangle text-warning fa-2x"></i>
                                        <div class="admin-stats-value" id="system-issues">3</div>
                                        <div class="admin-stats-title">System Issues</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity and System Status -->
                        <div class="row mt-4">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-history me-2"></i> Recent Activity
                                        <button class="btn btn-sm btn-outline-primary" id="refresh-logs">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="system-log" id="activity-log">
                                            <div class="log-entry">
                                                <span class="log-time">10:42:15</span>
                                                <span class="log-info">User 'admin' logged in from 192.168.1.15</span>
                                            </div>
                                            <div class="log-entry">
                                                <span class="log-time">10:38:22</span>
                                                <span class="log-success">Schedule optimized for Route 12A</span>
                                            </div>
                                            <div class="log-entry">
                                                <span class="log-time">10:35:10</span>
                                                <span class="log-warning">Bus B234 running 8 minutes behind schedule</span>
                                            </div>
                                            <div class="log-entry">
                                                <span class="log-time">10:30:45</span>
                                                <span class="log-info">New user 'johndoe' created by admin</span>
                                            </div>
                                            <div class="log-entry">
                                                <span class="log-time">10:25:30</span>
                                                <span class="log-error">API connection timeout to GPS service</span>
                                            </div>
                                            <div class="log-entry">
                                                <span class="log-time">10:20:15</span>
                                                <span class="log-info">System backup completed successfully</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-server me-2"></i> System Status
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>CPU Usage</span>
                                                <span id="cpu-usage">42%</span>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 42%"></div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>Memory Usage</span>
                                                <span id="memory-usage">68%</span>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 68%"></div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>Disk Space</span>
                                                <span id="disk-usage">35%</span>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-info" role="progressbar" style="width: 35%"></div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>Network Traffic</span>
                                                <span id="network-usage">1.2 Gb/s</span>
                                            </div>
                                            <div class="progress">
                                                <div class="progress-bar bg-primary" role="progressbar" style="width: 60%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Page -->
                <div id="user-management" class="page">
                    <div class="container-fluid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-users me-2"></i> User Management
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#userModal" data-action="add">
                                    <i class="fas fa-plus me-1"></i> Add User
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover admin-table" id="users-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Role</th>
                                                <th>Status</th>
                                                <th>Last Login</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="users-table-body">
                                            <!-- User data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bus Management Page -->
                <div id="bus-management" class="page">
                    <div class="container-fluid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-bus me-2"></i> Bus Management
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#busModal" data-action="add">
                                    <i class="fas fa-plus me-1"></i> Add Bus
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover admin-table" id="buses-table">
                                        <thead>
                                            <tr>
                                                <th>Bus ID</th>
                                                <th>License Plate</th>
                                                <th>Model</th>
                                                <th>Capacity</th>
                                                <th>Status</th>
                                                <th>Current Route</th>
                                                <th>Last Maintenance</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="buses-table-body">
                                            <!-- Bus data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Route Management Page -->
                <div id="route-management" class="page">
                    <div class="container-fluid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-route me-2"></i> Route Management
                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#routeModal" data-action="add">
                                    <i class="fas fa-plus me-1"></i> Add Route
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover admin-table" id="routes-table">
                                        <thead>
                                            <tr>
                                                <th>Route ID</th>
                                                <th>Route Name</th>
                                                <th>Start Point</th>
                                                <th>End Point</th>
                                                <th>Distance</th>
                                                <th>Estimated Time</th>
                                                <th>Stops</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="routes-table-body">
                                            <!-- Route data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timetable Management Page -->
                <div id="timetable-management" class="page">
                    <div class="container-fluid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-clock me-2"></i> Timetable Management
                                <div>
                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#timetableModal" data-action="add">
                                        <i class="fas fa-plus me-1"></i> Add Timetable Entry
                                    </button>
                                    <button class="btn btn-sm btn-outline-info ms-2" id="refresh-timetable">
                                        <i class="fas fa-sync-alt me-1"></i> Refresh
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            <input type="date" class="form-control" id="timetable-date" value="2023-10-15">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-route"></i></span>
                                            <select class="form-select" id="route-filter">
                                                <option value="">All Routes</option>
                                                <option value="R001">Route 12A</option>
                                                <option value="R002">Route 8B</option>
                                                <option value="R003">Route 15C</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="timetable-container" id="timetable-entries">
                                    <!-- Timetable entries will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Configuration Page -->
                <div id="system-config" class="page">
                    <div class="container-fluid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-cog me-2"></i> System Configuration
                                <button class="btn btn-sm btn-success" id="save-system-config">
                                    <i class="fas fa-save me-1"></i> Save Settings
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="settings-group">
                                            <h5 class="settings-title">General Settings</h5>
                                            <div class="mb-3">
                                                <label for="system-name" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="system-name" value="Smart Bus Management System">
                                            </div>
                                            <div class="mb-3">
                                                <label for="timezone" class="form-label">Timezone</label>
                                                <select class="form-select" id="timezone">
                                                    <option value="UTC-5">EST (UTC-5)</option>
                                                    <option value="UTC-6">CST (UTC-6)</option>
                                                    <option value="UTC-7">MST (UTC-7)</option>
                                                    <option value="UTC-8" selected>PST (UTC-8)</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="date-format" class="form-label">Date Format</label>
                                                <select class="form-select" id="date-format">
                                                    <option value="MM/DD/YYYY" selected>MM/DD/YYYY</option>
                                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="settings-group">
                                            <h5 class="settings-title">Notification Settings</h5>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="email-notifications" checked>
                                                <label class="form-check-label" for="email-notifications">Enable Email Notifications</label>
                                            </div>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="sms-notifications">
                                                <label class="form-check-label" for="sms-notifications">Enable SMS Notifications</label>
                                            </div>
                                            <div class="mb-3">
                                                <label for="notification-email" class="form-label">Notification Email Address</label>
                                                <input type="email" class="form-control" id="notification-email" value="admin@example.com">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="settings-group">
                                            <h5 class="settings-title">System Parameters</h5>
                                            <div class="mb-3">
                                                <label for="session-timeout" class="form-label">Session Timeout (minutes)</label>
                                                <input type="number" class="form-control" id="session-timeout" value="30" min="5" max="120">
                                            </div>
                                            <div class="mb-3">
                                                <label for="max-login-attempts" class="form-label">Max Login Attempts</label>
                                                <input type="number" class="form-control" id="max-login-attempts" value="5" min="1" max="10">
                                            </div>
                                            <div class="mb-3">
                                                <label for="data-retention" class="form-label">Data Retention Period (days)</label>
                                                <input type="number" class="form-control" id="data-retention" value="365" min="30" max="1095">
                                            </div>
                                        </div>
                                        
                                        <div class="settings-group">
                                            <h5 class="settings-title">Backup Settings</h5>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="auto-backup" checked>
                                                <label class="form-check-label" for="auto-backup">Enable Automatic Backups</label>
                                            </div>
                                            <div class="mb-3">
                                                <label for="backup-frequency" class="form-label">Backup Frequency</label>
                                                <select class="form-select" id="backup-frequency">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly" selected>Weekly</option>
                                                    <option value="monthly">Monthly</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="backup-time" class="form-label">Backup Time</label>
                                                <input type="time" class="form-control" id="backup-time" value="02:00">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Access Control Page -->
                <div id="access-control" class="page">
                    <div class="container-fluid mt-4">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-user-tag me-2"></i> Roles
                                        <button class="btn btn-sm btn-primary" id="add-role-btn">
                                            <i class="fas fa-plus me-1"></i> Add Role
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="list-group" id="roles-list">
                                            <a href="#" class="list-group-item list-group-item-action active" data-role-id="admin">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1">Administrator</h6>
                                                    <small>3 users</small>
                                                </div>
                                                <p class="mb-1">Full system access</p>
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-role-id="operator">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1">Operator</h6>
                                                    <small>8 users</small>
                                                </div>
                                                <p class="mb-1">Bus and route management</p>
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action" data-role-id="driver">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1">Driver</h6>
                                                    <small>25 users</small>
                                                </div>
                                                <p class="mb-1">Limited to assigned bus operations</p>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-7">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-key me-2"></i> Permissions for: <span id="selected-role">Administrator</span>
                                    </div>
                                    <div class="card-body">
                                        <div id="permissions-container">
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="user-management-perm" checked disabled>
                                                    <label class="form-check-label" for="user-management-perm">User Management</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="bus-management-perm" checked>
                                                    <label class="form-check-label" for="bus-management-perm">Bus Management</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="route-management-perm" checked>
                                                    <label class="form-check-label" for="route-management-perm">Route Management</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="timetable-management-perm" checked>
                                                    <label class="form-check-label" for="timetable-management-perm">Timetable Management</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="system-config-perm" checked>
                                                    <label class="form-check-label" for="system-config-perm">System Configuration</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="access-control-perm" checked disabled>
                                                    <label class="form-check-label" for="access-control-perm">Access Control</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="audit-logs-perm" checked>
                                                    <label class="form-check-label" for="audit-logs-perm">Audit Logs Access</label>
                                                </div>
                                            </div>
                                            <div class="permission-item">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="system-health-perm" checked>
                                                    <label class="form-check-label" for="system-health-perm">System Health Monitoring</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <button class="btn btn-primary btn-sm" id="save-permissions-btn">
                                                <i class="fas fa-save me-1"></i> Save Permissions
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Audit Logs Page -->
                <div id="audit-logs" class="page">
                    <div class="container-fluid mt-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-clipboard-list me-2"></i> Audit Logs
                                <button class="btn btn-sm btn-outline-primary" id="export-logs-btn">
                                    <i class="fas fa-download me-1"></i> Export Logs
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="log-filters">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="log-date-from" class="form-label">Date From</label>
                                                <input type="date" class="form-control" id="log-date-from">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="log-date-to" class="form-label">Date To</label>
                                                <input type="date" class="form-control" id="log-date-to">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="log-user" class="form-label">User</label>
                                                <select class="form-select" id="log-user">
                                                    <option value="">All Users</option>
                                                    <option value="admin">Admin</option>
                                                    <option value="johndoe">John Doe</option>
                                                    <option value="janesmith">Jane Smith</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="log-action" class="form-label">Action Type</label>
                                                <select class="form-select" id="log-action">
                                                    <option value="">All Actions</option>
                                                    <option value="login">Login</option>
                                                    <option value="create">Create</option>
                                                    <option value="update">Update</option>
                                                    <option value="delete">Delete</option>
                                                    <option value="system">System Event</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button class="btn btn-sm btn-secondary me-2" id="clear-filters-btn">
                                            <i class="fas fa-times me-1"></i> Clear Filters
                                        </button>
                                        <button class="btn btn-sm btn-primary" id="apply-filters-btn">
                                            <i class="fas fa-filter me-1"></i> Apply Filters
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover" id="audit-logs-table">
                                        <thead>
                                            <tr>
                                                <th>Timestamp</th>
                                                <th>User</th>
                                                <th>Action</th>
                                                <th>Details</th>
                                                <th>IP Address</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>2023-10-15 10:42:15</td>
                                                <td>admin</td>
                                                <td><span class="badge bg-success">Login</span></td>
                                                <td>User logged in successfully</td>
                                                <td>192.168.1.15</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-15 10:30:45</td>
                                                <td>admin</td>
                                                <td><span class="badge bg-info">Create</span></td>
                                                <td>Created new user: johndoe</td>
                                                <td>192.168.1.15</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-15 09:15:22</td>
                                                <td>janesmith</td>
                                                <td><span class="badge bg-primary">Update</span></td>
                                                <td>Updated bus B002 maintenance record</td>
                                                <td>192.168.1.27</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-14 16:45:33</td>
                                                <td>admin</td>
                                                <td><span class="badge bg-danger">Delete</span></td>
                                                <td>Deleted timetable entry T012</td>
                                                <td>192.168.1.15</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-14 14:20:18</td>
                                                <td>system</td>
                                                <td><span class="badge bg-secondary">System Event</span></td>
                                                <td>Automatic backup completed successfully</td>
                                                <td>127.0.0.1</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-14 10:05:52</td>
                                                <td>admin</td>
                                                <td><span class="badge bg-warning">Configuration</span></td>
                                                <td>Changed system timeout settings</td>
                                                <td>192.168.1.15</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-13 15:40:11</td>
                                                <td>johndoe</td>
                                                <td><span class="badge bg-success">Login</span></td>
                                                <td>User logged in successfully</td>
                                                <td>192.168.1.42</td>
                                            </tr>
                                            <tr>
                                                <td>2023-10-13 11:25:07</td>
                                                <td>admin</td>
                                                <td><span class="badge bg-info">Create</span></td>
                                                <td>Created new route: Route 22D</td>
                                                <td>192.168.1.15</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <nav aria-label="Audit log pagination">
                                    <ul class="pagination justify-content-center">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                    </nav>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Health Page -->
                <div id="system-health" class="page">
                    <div class="container-fluid mt-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-microchip me-2"></i> CPU Usage
                                        <span class="badge bg-success" id="cpu-status">Normal</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="cpu-usage-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-memory me-2"></i> Memory Usage
                                        <span class="badge bg-warning" id="memory-status">High</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="memory-usage-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-hdd me-2"></i> Disk Usage
                                        <span class="badge bg-success" id="disk-status">Normal</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="disk-usage-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-network-wired me-2"></i> Network Traffic
                                        <span class="badge bg-success" id="network-status">Normal</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="network-usage-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-list me-2"></i> System Services Status
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Service</th>
                                                        <th>Status</th>
                                                        <th>Uptime</th>
                                                        <th>CPU</th>
                                                        <th>Memory</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Web Server</td>
                                                        <td><span class="badge bg-success">Running</span></td>
                                                        <td>12 days, 4:32:11</td>
                                                        <td>2.4%</td>
                                                        <td>124 MB</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">Restart</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Database</td>
                                                        <td><span class="badge bg-success">Running</span></td>
                                                        <td>12 days, 4:32:11</td>
                                                        <td>5.7%</td>
                                                        <td>342 MB</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">Restart</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>GPS Tracking</td>
                                                        <td><span class="badge bg-success">Running</span></td>
                                                        <td>3 days, 12:45:22</td>
                                                        <td>8.1%</td>
                                                        <td>87 MB</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">Restart</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Notification Service</td>
                                                        <td><span class="badge bg-danger">Stopped</span></td>
                                                        <td>N/A</td>
                                                        <td>0%</td>
                                                        <td>0 MB</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-success">Start</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>API Gateway</td>
                                                        <td><span class="badge bg-success">Running</span></td>
                                                        <td>12 days, 4:32:11</td>
                                                        <td>3.2%</td>
                                                        <td>156 MB</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">Restart</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="user-form" id="userForm">
                        <input type="hidden" id="user-id">
                        <div class="mb-3">
                            <label for="userName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="userName" required>
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="userEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="userRole" class="form-label">Role</label>
                            <select class="form-select" id="userRole" required>
                                <option value="">Select Role</option>
                                <option value="admin">Administrator</option>
                                <option value="operator">Operator</option>
                                <option value="driver">Driver</option>
                            </select>
                        </div>
                        <div class="mb-3" id="user-password-field">
                            <label for="userPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="userPassword" required>
                        </div>
                        <div class="mb-3" id="user-confirm-password-field">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="userStatus" class="form-label">Status</label>
                            <select class="form-select" id="userStatus" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveUser">Save User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bus Modal -->
    <div class="modal fade" id="busModal" tabindex="-1" aria-labelledby="busModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="busModalLabel">Add New Bus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="bus-form" id="busForm">
                        <input type="hidden" id="bus-id">
                        <div class="mb-3">
                            <label for="busLicense" class="form-label">License Plate</label>
                            <input type="text" class="form-control" id="busLicense" required>
                        </div>
                        <div class="mb-3">
                            <label for="busModel" class="form-label">Model</label>
                            <input type="text" class="form-control" id="busModel" required>
                        </div>
                        <div class="mb-3">
                            <label for="busCapacity" class="form-label">Passenger Capacity</label>
                            <input type="number" class="form-control" id="busCapacity" min="10" max="100" required>
                        </div>
                        <div class="mb-3">
                            <label for="busStatus" class="form-label">Status</label>
                            <select class="form-select" id="busStatus" required>
                                <option value="active">Active</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="busRoute" class="form-label">Assigned Route</label>
                            <select class="form-select" id="busRoute">
                                <option value="">Select Route (Optional)</option>
                                <option value="R001">Route 12A</option>
                                <option value="R002">Route 8B</option>
                                <option value="R003">Route 15C</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="lastMaintenance" class="form-label">Last Maintenance Date</label>
                            <input type="date" class="form-control" id="lastMaintenance" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveBus">Save Bus</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Route Modal -->
    <div class="modal fade" id="routeModal" tabindex="-1" aria-labelledby="routeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="routeModalLabel">Add New Route</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="route-form" id="routeForm">
                        <input type="hidden" id="route-id">
                        <div class="mb-3">
                            <label for="routeName" class="form-label">Route Name</label>
                            <input type="text" class="form-control" id="routeName" required>
                        </div>
                        <div class="mb-3">
                            <label for="startPoint" class="form-label">Start Point</label>
                            <input type="text" class="form-control" id="startPoint" required>
                        </div>
                        <div class="mb-3">
                            <label for="endPoint" class="form-label">End Point</label>
                            <input type="text" class="form-control" id="endPoint" required>
                        </div>
                        <div class="mb-3">
                            <label for="routeDistance" class="form-label">Distance (km)</label>
                            <input type="number" class="form-control" id="routeDistance" step="0.1" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="estimatedTime" class="form-label">Estimated Time (minutes)</label>
                            <input type="number" class="form-control" id="estimatedTime" min="5" required>
                        </div>
                        <div class="mb-3">
                            <label for="numberOfStops" class="form-label">Number of Stops</label>
                            <input type="number" class="form-control" id="numberOfStops" min="2" required>
                        </div>
                        <div class="mb-3">
                            <label for="routeStatus" class="form-label">Status</label>
                            <select class="form-select" id="routeStatus" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveRoute">Save Route</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Timetable Modal -->
    <div class="modal fade" id="timetableModal" tabindex="-1" aria-labelledby="timetableModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="timetableModalLabel">Add Timetteable Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="timetable-form" id="timetableForm">
                        <input type="hidden" id="timetable-id">
                        <div class="mb-3">
                            <label for="timetableRoute" class="form-label">Route</label>
                            <select class="form-select" id="timetableRoute" required>
                                <option value="">Select Route</option>
                                <option value="R001">Route 12A</option>
                                <option value="R002">Route 8B</option>
                                <option value="R003">Route 15C</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="timetableBus" class="form-label">Bus</label>
                            <select class="form-select" id="timetableBus" required>
                                <option value="">Select Bus</option>
                                <option value="B001">B001 (ABC123)</option>
                                <option value="B002">B002 (XYZ789)</option>
                                <option value="B004">B004 (GHI789)</option>
                                <option value="B005">B005 (JKL012)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="timetableDriver" class="form-label">Driver</label>
                            <select class="form-select" id="timetableDriver" required>
                                <option value="">Select Driver</option>
                                <option value="U001">John Doe</option>
                                <option value="U003">Robert Johnson</option>
                                <option value="U005">Michael Brown</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="departureTime" class="form-label">Departure Time</label>
                            <input type="time" class="form-control" id="departureTime" required>
                        </div>
                        <div class="mb-3">
                            <label for="arrivalTime" class="form-label">Estimated Arrival Time</label>
                            <input type="time" class="form-control" id="arrivalTime" required>
                        </div>
                        <div class="mb-3">
                            <label for="timetableStatus" class="form-label">Status</label>
                            <select class="form-select" id="timetableStatus" required>
                                <option value="scheduled">Scheduled</option>
                                <option value="on-time">On Time</option>
                                <option value="delayed">Delayed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveTimetable">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this item? This action cannot be undone.</p>
                    <input type="hidden" id="delete-id">
                    <input type="hidden" id="delete-type">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Data storage for all entities
        let usersData = [
            { id: 'U001', name: 'John Doe', email: 'john@example.com', role: 'admin', status: 'active', lastLogin: '2023-10-15 10:42:15' },
            { id: 'U002', name: 'Jane Smith', email: 'jane@example.com', role: 'operator', status: 'active', lastLogin: '2023-10-14 16:30:22' },
            { id: 'U003', name: 'Robert Johnson', email: 'robert@example.com', role: 'driver', status: 'pending', lastLogin: '2023-10-13 09:15:47' },
            { id: 'U004', name: 'Sarah Williams', email: 'sarah@example.com', role: 'operator', status: 'inactive', lastLogin: '2023-10-10 14:20:33' },
            { id: 'U005', name: 'Michael Brown', email: 'michael@example.com', role: 'driver', status: 'active', lastLogin: '2023-10-15 08:55:12' }
        ];

        let busesData = [
            { id: 'B001', license: 'ABC123', model: 'Mercedes Sprinter', capacity: 30, status: 'active', route: 'R001', lastMaintenance: '2023-09-15' },
            { id: 'B002', license: 'XYZ789', model: 'Volvo 9700', capacity: 50, status: 'active', route: 'R002', lastMaintenance: '2023-10-01' },
            { id: 'B003', license: 'DEF456', model: 'Scania Citywide', capacity: 45, status: 'maintenance', route: '', lastMaintenance: '2023-10-10' },
            { id: 'B004', license: 'GHI789', model: 'MAN Lion\'s City', capacity: 40, status: 'active', route: 'R003', lastMaintenance: '2023-09-28' }
        ];

        let routesData = [
            { id: 'R001', name: 'Route 12A', start: 'Central Station', end: 'North Terminal', distance: 15.2, time: 45, stops: 18, status: 'active' },
            { id: 'R002', name: 'Route 8B', start: 'East Gate', end: 'West Mall', distance: 12.7, time: 38, stops: 15, status: 'active' },
            { id: 'R003', name: 'Route 15C', start: 'South Park', end: 'City Center', distance: 9.8, time: 30, stops: 12, status: 'active' },
            { id: 'R004', name: 'Route 22D', start: 'Airport', end: 'University', distance: 20.5, time: 55, stops: 22, status: 'inactive' }
        ];

        let timetableData = [
            { id: 'T001', route: 'R001', bus: 'B001', driver: 'U005', departure: '08:00', arrival: '08:45', status: 'on-time', date: '2023-10-15' },
            { id: 'T002', route: 'R002', bus: 'B002', driver: 'U003', departure: '08:15', arrival: '08:53', status: 'delayed', date: '2023-10-15' },
            { id: 'T003', route: 'R003', bus: 'B004', driver: 'U004', departure: '08:30', arrival: '09:00', status: 'on-time', date: '2023-10-15' },
            { id: 'T004', route: 'R001', bus: 'B005', driver: 'U001', departure: '08:45', arrival: '09:30', status: 'on-time', date: '2023-10-15' },
            { id: 'T005', route: 'R002', bus: 'B003', driver: '', departure: '09:00', arrival: '09:38', status: 'cancelled', date: '2023-10-15' }
        ];

        // System configuration data
        let systemConfig = {
            systemName: "Smart Bus Management System",
            timezone: "UTC-8",
            dateFormat: "MM/DD/YYYY",
            emailNotifications: true,
            smsNotifications: false,
            notificationEmail: "admin@example.com",
            sessionTimeout: 30,
            maxLoginAttempts: 5,
            dataRetention: 365,
            autoBackup: true,
            backupFrequency: "weekly",
            backupTime: "02:00"
        };

        // Role permissions data
        let rolePermissions = {
            admin: {
                name: "Administrator",
                userManagement: true,
                busManagement: true,
                routeManagement: true,
                timetableManagement: true,
                systemConfig: true,
                accessControl: true,
                auditLogs: true,
                systemHealth: true
            },
            operator: {
                name: "Operator",
                userManagement: false,
                busManagement: true,
                routeManagement: true,
                timetableManagement: true,
                systemConfig: false,
                accessControl: false,
                auditLogs: true,
                systemHealth: false
            },
            driver: {
                name: "Driver",
                userManagement: false,
                busManagement: false,
                routeManagement: false,
                timetableManagement: false,
                systemConfig: false,
                accessControl: false,
                auditLogs: false,
                systemHealth: false
            }
        };

        // Current editing item
        let currentEditingItem = null;
        let currentSelectedRole = "admin";

        // Function to show toast notification
        function showToast(message, type = 'info') {
            const toast = $(`
                <div class="toast align-items-center text-white bg-${type}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `);
            
            $('.toast-container').append(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Remove toast after it's hidden
            toast.on('hidden.bs.toast', function() {
                $(this).remove();
            });
        }

        // Function to update dashboard stats
        function updateDashboardStats() {
            // Update user count
            $('#total-users').text(usersData.length);
            
            // Update bus count
            const activeBuses = busesData.filter(bus => bus.status === 'active').length;
            $('#active-buses').text(activeBuses);
            
            // Update route count
            const activeRoutes = routesData.filter(route => route.status === 'active').length;
            $('#total-routes').text(activeRoutes);
            
            // Update system issues count
            const maintenanceBuses = busesData.filter(bus => bus.status === 'maintenance').length;
            const stoppedServices = 1; // Notification service is stopped
            $('#system-issues').text(maintenanceBuses + stoppedServices);
        }

        // Function to render users table
        function renderUsersTable() {
            const tableBody = $('#users-table-body');
            tableBody.empty();
            
            usersData.forEach(user => {
                // Determine badge classes based on role and status
                let roleBadgeClass = 'bg-primary';
                if (user.role === 'operator') {
                    roleBadgeClass = 'bg-secondary';
                } else if (user.role === 'driver') {
                    roleBadgeClass = 'bg-info';
                }
                
                let statusBadgeClass = 'bg-success';
                if (user.status === 'inactive') {
                    statusBadgeClass = 'bg-secondary';
                } else if (user.status === 'pending') {
                    statusBadgeClass = 'bg-warning';
                }
                
                const row = `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td><span class="badge ${roleBadgeClass} user-role">${user.role}</span></td>
                        <td><span class="badge ${statusBadgeClass}">${user.status}</span></td>
                        <td>${user.lastLogin}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary edit-user" data-id="${user.id}"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-outline-danger delete-user" data-id="${user.id}"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }

        // Function to render buses table
        function renderBusesTable() {
            const tableBody = $('#buses-table-body');
            tableBody.empty();
            
            busesData.forEach(bus => {
                let statusBadgeClass = 'bg-success';
                if (bus.status === 'maintenance') {
                    statusBadgeClass = 'bg-warning';
                } else if (bus.status === 'inactive') {
                    statusBadgeClass = 'bg-secondary';
                }
                
                const routeName = bus.route ? routesData.find(r => r.id === bus.route)?.name || bus.route : 'N/A';
                
                const row = `
                    <tr>
                        <td>${bus.id}</td>
                        <td>${bus.license}</td>
                        <td>${bus.model}</td>
                        <td>${bus.capacity}</td>
                        <td><span class="badge ${statusBadgeClass}">${bus.status}</span></td>
                        <td>${routeName}</td>
                        <td>${bus.lastMaintenance}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary edit-bus" data-id="${bus.id}"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-outline-danger delete-bus" data-id="${bus.id}"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }

        // Function to render routes table
        function renderRoutesTable() {
            const tableBody = $('#routes-table-body');
            tableBody.empty();
            
            routesData.forEach(route => {
                let statusBadgeClass = 'bg-success';
                if (route.status === 'inactive') {
                    statusBadgeClass = 'bg-secondary';
                }
                
                const row = `
                    <tr>
                        <td>${route.id}</td>
                        <td>${route.name}</td>
                        <td>${route.start}</td>
                        <td>${route.end}</td>
                        <td>${route.distance} km</td>
                        <td>${route.time} min</td>
                        <td>${route.stops}</td>
                        <td><span class="badge ${statusBadgeClass}">${route.status}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary edit-route" data-id="${route.id}"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-outline-danger delete-route" data-id="${route.id}"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
                
                tableBody.append(row);
            });
        }

        // Function to render timetable entries
        function renderTimetable() {
            const container = $('#timetable-entries');
            container.empty();
            
            const selectedDate = $('#timetable-date').val();
            const routeFilter = $('#route-filter').val();
            
            let filteredTimetable = timetableData.filter(entry => entry.date === selectedDate);
            
            if (routeFilter) {
                filteredTimetable = filteredTimetable.filter(entry => entry.route === routeFilter);
            }
            
            filteredTimetable.forEach(entry => {
                const route = routesData.find(r => r.id === entry.route) || { name: 'Unknown Route' };
                const bus = busesData.find(b => b.id === entry.bus) || { license: 'Unknown Bus' };
                const driver = usersData.find(u => u.id === entry.driver) || { name: 'Unassigned' };
                
                let statusClass = 'bg-success';
                if (entry.status === 'delayed') {
                    statusClass = 'bg-warning';
                } else if (entry.status === 'cancelled') {
                    statusClass = 'bg-danger';
                } else if (entry.status === 'scheduled') {
                    statusClass = 'bg-info';
                }
                
                const timetableEntry = `
                    <div class="timetable-entry">
                        <div class="d-flex justify-content-between">
                            <span class="timetable-time">${entry.departure}</span>
                            <span class="badge ${statusClass} timetable-status">${entry.status}</span>
                        </div>
                        <div class="timetable-route">${route.name} - ${route.start} to ${route.end}</div>
                        <div>Bus: ${bus.id} (${bus.license}) | Driver: ${driver.name}</div>
                        <div class="mt-2 action-buttons">
                            <button class="btn btn-sm btn-outline-primary edit-timetable" data-id="${entry.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-outline-danger delete-timetable" data-id="${entry.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
                
                container.append(timetableEntry);
            });
        }

        // Function to load system configuration
        function loadSystemConfig() {
            $('#system-name').val(systemConfig.systemName);
            $('#timezone').val(systemConfig.timezone);
            $('#date-format').val(systemConfig.dateFormat);
            $('#email-notifications').prop('checked', systemConfig.emailNotifications);
            $('#sms-notifications').prop('checked', systemConfig.smsNotifications);
            $('#notification-email').val(systemConfig.notificationEmail);
            $('#session-timeout').val(systemConfig.sessionTimeout);
            $('#max-login-attempts').val(systemConfig.maxLoginAttempts);
            $('#data-retention').val(systemConfig.dataRetention);
            $('#auto-backup').prop('checked', systemConfig.autoBackup);
            $('#backup-frequency').val(systemConfig.backupFrequency);
            $('#backup-time').val(systemConfig.backupTime);
        }

        // Function to load role permissions
        function loadRolePermissions(roleId) {
            const role = rolePermissions[roleId];
            if (!role) return;
            
            $('#selected-role').text(role.name);
            $('#user-management-perm').prop('checked', role.userManagement);
            $('#bus-management-perm').prop('checked', role.busManagement);
            $('#route-management-perm').prop('checked', role.routeManagement);
            $('#timetable-management-perm').prop('checked', role.timetableManagement);
            $('#system-config-perm').prop('checked', role.systemConfig);
            $('#access-control-perm').prop('checked', role.accessControl);
            $('#audit-logs-perm').prop('checked', role.auditLogs);
            $('#system-health-perm').prop('checked', role.systemHealth);
            
            // Disable admin-specific permissions for non-admin roles
            const isAdmin = roleId === 'admin';
            $('#user-management-perm').prop('disabled', !isAdmin);
            $('#access-control-perm').prop('disabled', !isAdmin);
        }

        // Function to create system health charts
        function createSystemHealthCharts() {
            // CPU Usage Chart
            const cpuCtx = document.getElementById('cpu-usage-chart').getContext('2d');
            if (window.cpuChart) window.cpuChart.destroy();
            window.cpuChart = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: ['10:00', '10:05', '10:10', '10:15', '10:20', '10:25', '10:30', '10:35', '10:40', '10:45'],
                    datasets: [{
                        label: 'CPU Usage (%)',
                        data: [35, 40, 38, 45, 42, 48, 50, 55, 52, 49],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Memory Usage Chart
            const memoryCtx = document.getElementById('memory-usage-chart').getContext('2d');
            if (window.memoryChart) window.memoryChart.destroy();
            window.memoryChart = new Chart(memoryCtx, {
                type: 'line',
                data: {
                    labels: ['10:00', '10:05', '10:10', '10:15', '10:20', '10:25', '10:30', '10:35', '10:40', '10:45'],
                    datasets: [{
                        label: 'Memory Usage (%)',
                        data: [65, 68, 70, 72, 75, 73, 70, 68, 72, 75],
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Disk Usage Chart
            const diskCtx = document.getElementById('disk-usage-chart').getContext('2d');
            if (window.diskChart) window.diskChart.destroy();
            window.diskChart = new Chart(diskCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Used', 'Free'],
                    datasets: [{
                        data: [35, 65],
                        backgroundColor: ['#17a2b8', '#e9ecef'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Network Usage Chart
            const networkCtx = document.getElementById('network-usage-chart').getContext('2d');
            if (window.networkChart) window.networkChart.destroy();
            window.networkChart = new Chart(networkCtx, {
                type: 'bar',
                data: {
                    labels: ['10:00', '10:05', '10:10', '10:15', '10:20', '10:25', '10:30', '10:35', '10:40', '10:45'],
                    datasets: [{
                        label: 'Network Traffic (Mb/s)',
                        data: [0.8, 1.2, 0.9, 1.5, 1.1, 0.7, 1.3, 1.0, 0.9, 1.2],
                        backgroundColor: '#4361ee'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Function to open edit modal for users
        function openEditUserModal(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                $('#userModalLabel').text('Edit User');
                $('#user-id').val(user.id);
                $('#userName').val(user.name);
                $('#userEmail').val(user.email);
                $('#userRole').val(user.role);
                $('#userStatus').val(user.status);
                $('#user-password-field').hide();
                $('#user-confirm-password-field').hide();
                $('#userPassword').removeAttr('required');
                $('#confirmPassword').removeAttr('required');
                
                currentEditingItem = { type: 'user', data: user };
                $('#userModal').modal('show');
            }
        }

        // Function to open edit modal for buses
        function openEditBusModal(busId) {
            const bus = busesData.find(b => b.id === busId);
            if (bus) {
                $('#busModalLabel').text('Edit Bus');
                $('#bus-id').val(bus.id);
                $('#busLicense').val(bus.license);
                $('#busModel').val(bus.model);
                $('#busCapacity').val(bus.capacity);
                $('#busStatus').val(bus.status);
                $('#busRoute').val(bus.route);
                $('#lastMaintenance').val(bus.lastMaintenance);
                
                currentEditingItem = { type: 'bus', data: bus };
                $('#busModal').modal('show');
            }
        }

        // Function to open edit modal for routes
        function openEditRouteModal(routeId) {
            const route = routesData.find(r => r.id === routeId);
            if (route) {
                $('#routeModalLabel').text('Edit Route');
                $('#route-id').val(route.id);
                $('#routeName').val(route.name);
                $('#startPoint').val(route.start);
                $('#endPoint').val(route.end);
                $('#routeDistance').val(route.distance);
                $('#estimatedTime').val(route.time);
                $('#numberOfStops').val(route.stops);
                $('#routeStatus').val(route.status);
                
                currentEditingItem = { type: 'route', data: route };
                $('#routeModal').modal('show');
            }
        }

        // Function to open edit modal for timetable
        function openEditTimetableModal(timetableId) {
            const entry = timetableData.find(t => t.id === timetableId);
            if (entry) {
                $('#timetableModalLabel').text('Edit Timetable Entry');
                $('#timetable-id').val(entry.id);
                $('#timetableRoute').val(entry.route);
                $('#timetableBus').val(entry.bus);
                $('#timetableDriver').val(entry.driver);
                $('#departureTime').val(entry.departure);
                $('#arrivalTime').val(entry.arrival);
                $('#timetableStatus').val(entry.status);
                
                currentEditingItem = { type: 'timetable', data: entry };
                $('#timetableModal').modal('show');
            }
        }

        // Function to prepare delete confirmation
        function prepareDelete(id, type) {
            $('#delete-id').val(id);
            $('#delete-type').val(type);
            $('#deleteModal').modal('show');
        }

        // Function to handle delete confirmation
        function confirmDelete() {
            const id = $('#delete-id').val();
            const type = $('#delete-type').val();
            
            switch(type) {
                case 'user':
                    usersData = usersData.filter(user => user.id !== id);
                    renderUsersTable();
                    showToast('User deleted successfully!', 'success');
                    break;
                case 'bus':
                    busesData = busesData.filter(bus => bus.id !== id);
                    renderBusesTable();
                    showToast('Bus deleted successfully!', 'success');
                    break;
                case 'route':
                    routesData = routesData.filter(route => route.id !== id);
                    renderRoutesTable();
                    showToast('Route deleted successfully!', 'success');
                    break;
                case 'timetable':
                    timetableData = timetableData.filter(entry => entry.id !== id);
                    renderTimetable();
                    showToast('Timetable entry deleted successfully!', 'success');
                    break;
            }
            
            updateDashboardStats();
            $('#deleteModal').modal('hide');
        }

        $(document).ready(function() {
            // Initialize data
            updateDashboardStats();
            renderUsersTable();
            renderBusesTable();
            renderRoutesTable();
            renderTimetable();
            loadSystemConfig();
            loadRolePermissions(currentSelectedRole);
            
            // Update current time
            function updateTime() {
                const now = new Date();
                $('#current-time').text(now.toLocaleTimeString());
            }
            updateTime();
            setInterval(updateTime, 1000);
            
            // Sidebar toggle for mobile
            $('#sidebar-toggle').click(function() {
                $('#sidebar').toggleClass('show');
                $('#sidebar-overlay').toggleClass('active');
            });
            
            $('#sidebar-overlay').click(function() {
                $('#sidebar').removeClass('show');
                $('#sidebar-overlay').removeClass('active');
            });
            
            // Page navigation
            $('.nav-link').click(function(e) {
                if ($(this).attr('href').startsWith('#')) {
                    e.preventDefault();
                    
                    // Update active link
                    $('.nav-link').removeClass('active');
                    $(this).addClass('active');
                    
                    // Show the corresponding page
                    const pageId = $(this).data('page');
                    $('.page').removeClass('active');
                    $('#' + pageId).addClass('active');
                    
                    // Update page title
                    $('#page-title').text($(this).find('span').text());
                    
                    // Close sidebar on mobile after selection
                    if ($(window).width() < 768) {
                        $('#sidebar').removeClass('show');
                        $('#sidebar-overlay').removeClass('active');
                    }
                    
                    // Initialize charts when system health page is shown
                    if (pageId === 'system-health') {
                        setTimeout(createSystemHealthCharts, 100);
                    }
                }
            });
            
            // Refresh logs
            $('#refresh-logs').click(function() {
                const $log = $('#activity-log');
                $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-info">Logs refreshed by admin</span></div>');
                $log.scrollTop($log[0].scrollHeight);
                showToast('Logs refreshed!', 'success');
            });
            
            // Refresh timetable
            $('#refresh-timetable').click(function() {
                renderTimetable();
                showToast('Timetable refreshed!', 'success');
            });
            
            // Timetable filters
            $('#timetable-date, #route-filter').change(function() {
                renderTimetable();
            });
            
            // Save system configuration
            $('#save-system-config').click(function() {
                systemConfig.systemName = $('#system-name').val();
                systemConfig.timezone = $('#timezone').val();
                systemConfig.dateFormat = $('#date-format').val();
                systemConfig.emailNotifications = $('#email-notifications').is(':checked');
                systemConfig.smsNotifications = $('#sms-notifications').is(':checked');
                systemConfig.notificationEmail = $('#notification-email').val();
                systemConfig.sessionTimeout = $('#session-timeout').val();
                systemConfig.maxLoginAttempts = $('#max-login-attempts').val();
                systemConfig.dataRetention = $('#data-retention').val();
                systemConfig.autoBackup = $('#auto-backup').is(':checked');
                systemConfig.backupFrequency = $('#backup-frequency').val();
                systemConfig.backupTime = $('#backup-time').val();
                
                showToast('System configuration saved successfully!', 'success');
                
                // Add to activity log
                const $log = $('#activity-log');
                $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-success">System configuration updated by admin</span></div>');
                $log.scrollTop($log[0].scrollHeight);
            });
            
            // Role selection in access control
            $('#roles-list a').click(function(e) {
                e.preventDefault();
                $('#roles-list a').removeClass('active');
                $(this).addClass('active');
                
                const roleId = $(this).data('role-id');
                currentSelectedRole = roleId;
                loadRolePermissions(roleId);
            });
            
            // Save permissions
            $('#save-permissions-btn').click(function() {
                if (currentSelectedRole) {
                    rolePermissions[currentSelectedRole].busManagement = $('#bus-management-perm').is(':checked');
                    rolePermissions[currentSelectedRole].routeManagement = $('#route-management-perm').is(':checked');
                    rolePermissions[currentSelectedRole].timetableManagement = $('#timetable-management-perm').is(':checked');
                    rolePermissions[currentSelectedRole].systemConfig = $('#system-config-perm').is(':checked');
                    rolePermissions[currentSelectedRole].auditLogs = $('#audit-logs-perm').is(':checked');
                    rolePermissions[currentSelectedRole].systemHealth = $('#system-health-perm').is(':checked');
                    
                    showToast('Permissions saved for ' + rolePermissions[currentSelectedRole].name + ' role!', 'success');
                    
                    // Add to activity log
                    const $log = $('#activity-log');
                    $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-success">Permissions updated for ' + rolePermissions[currentSelectedRole].name + ' role</span></div>');
                    $log.scrollTop($log[0].scrollHeight);
                }
            });
            
            // Apply log filters
            $('#apply-filters-btn').click(function() {
                const dateFrom = $('#log-date-from').val();
                const dateTo = $('#log-date-to').val();
                const user = $('#log-user').val();
                const action = $('#log-action').val();
                
                // In a real application, this would filter the log data
                // For this demo, we'll just show a toast notification
                let filterMsg = 'Filters applied: ';
                if (dateFrom) filterMsg += 'From ' + dateFrom + ' ';
                if (dateTo) filterMsg += 'To ' + dateTo + ' ';
                if (user) filterMsg += 'User: ' + user + ' ';
                if (action) filterMsg += 'Action: ' + action;
                
                showToast(filterMsg, 'info');
            });
            
            // Clear log filters
            $('#clear-filters-btn').click(function() {
                $('#log-date-from').val('');
                $('#log-date-to').val('');
                $('#log-user').val('');
                $('#log-action').val('');
                showToast('Filters cleared', 'info');
            });
            
            // Export logs
            $('#export-logs-btn').click(function() {
                showToast('Exporting audit logs...', 'info');
                // In a real application, this would trigger a download
                setTimeout(() => {
                    showToast('Audit logs exported successfully!', 'success');
                }, 1500);
            });
            
            // Modal show events to reset forms
            $('#userModal, #busModal, #routeModal, #timetableModal').on('show.bs.modal', function(e) {
                const button = $(e.relatedTarget);
                const action = button.data('action');
                
                if (action === 'add') {
                    $(this).find('.modal-title').text('Add New ' + $(this).find('.modal-title').text().replace('Add New ', ''));
                    $(this).find('form')[0].reset();
                    $(this).find('input[type="hidden"]').val('');
                    
                    if ($(this).attr('id') === 'userModal') {
                        $('#user-password-field').show();
                        $('#user-confirm-password-field').show();
                        $('#userPassword').attr('required', 'required');
                        $('#confirmPassword').attr('required', 'required');
                    }
                    
                    currentEditingItem = null;
                }
            });
            
            // Modal hide events
            $('#userModal, #busModal, #routeModal, #timetableModal').on('hidden.bs.modal', function() {
                currentEditingItem = null;
            });
            
            // Save user
            $('#saveUser').click(function() {
                if ($('#userForm')[0].checkValidity()) {
                    if ($('#userPassword').val() !== $('#confirmPassword').val()) {
                        showToast('Passwords do not match!', 'danger');
                        return;
                    }
                    
                    const userData = {
                        id: $('#user-id').val() || 'U' + (100 + usersData.length + 1),
                        name: $('#userName').val(),
                        email: $('#userEmail').val(),
                        role: $('#userRole').val(),
                        status: $('#userStatus').val(),
                        lastLogin: new Date().toLocaleString()
                    };
                    
                    if (currentEditingItem && currentEditingItem.type === 'user') {
                        // Update existing user
                        const index = usersData.findIndex(u => u.id === userData.id);
                        if (index !== -1) {
                            usersData[index] = userData;
                            showToast('User updated successfully!', 'success');
                        }
                    } else {
                        // Add new user
                        usersData.push(userData);
                        showToast('User added successfully!', 'success');
                    }
                    
                    // Update UI
                    renderUsersTable();
                    updateDashboardStats();
                    
                    // Reset form and close modal
                    $('#userForm')[0].reset();
                    $('#userModal').modal('hide');
                    
                    // Add to activity log
                    const $log = $('#activity-log');
                    $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-success">User \'' + userData.name + '\' ' + (currentEditingItem ? 'updated' : 'created') + ' by admin</span></div>');
                    $log.scrollTop($log[0].scrollHeight);
                } else {
                    $('#userForm')[0].reportValidity();
                }
            });
            
            // Save bus
            $('#saveBus').click(function() {
                if ($('#busForm')[0].checkValidity()) {
                    const busData = {
                        id: $('#bus-id').val() || 'B' + (100 + busesData.length + 1),
                        license: $('#busLicense').val(),
                        model: $('#busModel').val(),
                        capacity: $('#busCapacity').val(),
                        status: $('#busStatus').val(),
                        route: $('#busRoute').val(),
                        lastMaintenance: $('#lastMaintenance').val()
                    };
                    
                    if (currentEditingItem && currentEditingItem.type === 'bus') {
                        // Update existing bus
                        const index = busesData.findIndex(b => b.id === busData.id);
                        if (index !== -1) {
                            busesData[index] = busData;
                            showToast('Bus updated successfully!', 'success');
                        }
                    } else {
                        // Add new bus
                        busesData.push(busData);
                        showToast('Bus added successfully!', 'success');
                    }
                    
                    // Update UI
                    renderBusesTable();
                    updateDashboardStats();
                    
                    // Reset form and close modal
                    $('#busForm')[0].reset();
                    $('#busModal').modal('hide');
                    
                    // Add to activity log
                    const $log = $('#activity-log');
                    $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-success">Bus \'' + busData.license + '\' ' + (currentEditingItem ? 'updated' : 'added') + ' by admin</span></div>');
                    $log.scrollTop($log[0].scrollHeight);
                } else {
                    $('#busForm')[0].reportValidity();
                }
            });
            
            // Save route
            $('#saveRoute').click(function() {
                if ($('#routeForm')[0].checkValidity()) {
                    const routeData = {
                        id: $('#route-id').val() || 'R' + (100 + routesData.length + 1),
                        name: $('#routeName').val(),
                        start: $('#startPoint').val(),
                        end: $('#endPoint').val(),
                        distance: $('#routeDistance').val(),
                        time: $('#estimatedTime').val(),
                        stops: $('#numberOfStops').val(),
                        status: $('#routeStatus').val()
                    };
                    
                    if (currentEditingItem && currentEditingItem.type === 'route') {
                        // Update existing route
                        const index = routesData.findIndex(r => r.id === routeData.id);
                        if (index !== -1) {
                            routesData[index] = routeData;
                            showToast('Route updated successfully!', 'success');
                        }
                    } else {
                        // Add new route
                        routesData.push(routeData);
                        showToast('Route added successfully!', 'success');
                    }
                    
                    // Update UI
                    renderRoutesTable();
                    updateDashboardStats();
                    
                    // Reset form and close modal
                    $('#routeForm')[0].reset();
                    $('#routeModal').modal('hide');
                    
                    // Add to activity log
                    const $log = $('#activity-log');
                    $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-success">Route \'' + routeData.name + '\' ' + (currentEditingItem ? 'updated' : 'added') + ' by admin</span></div>');
                    $log.scrollTop($log[0].scrollHeight);
                } else {
                    $('#routeForm')[0].reportValidity();
                }
            });
            
            // Save timetable
            $('#saveTimetable').click(function() {
                if ($('#timetableForm')[0].checkValidity()) {
                    const newTimetableEntry = {
                        id: $('#timetable-id').val() || 'T' + (100 + timetableData.length + 1),
                        route: $('#timetableRoute').val(),
                        bus: $('#timetableBus').val(),
                        driver: $('#timetableDriver').val(),
                        departure: $('#departureTime').val(),
                        arrival: $('#arrivalTime').val(),
                        status: $('#timetableStatus').val(),
                        date: $('#timetable-date').val() || '2023-10-15'
                    };
                    
                    if (currentEditingItem && currentEditingItem.type === 'timetable') {
                        // Update existing timetable entry
                        const index = timetableData.findIndex(t => t.id === newTimetableEntry.id);
                        if (index !== -1) {
                            timetableData[index] = newTimetableEntry;
                            showToast('Timetable entry updated successfully!', 'success');
                        }
                    } else {
                        // Add new timetable entry
                        timetableData.push(newTimetableEntry);
                        showToast('Timetable entry added successfully!', 'success');
                    }
                    
                    // Update UI
                    renderTimetable();
                    
                    // Reset form and close modal
                    $('#timetableForm')[0].reset();
                    $('#timetableModal').modal('hide');
                    
                    // Add to activity log
                    const $log = $('#activity-log');
                    $log.append('<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-success">Timetable entry ' + (currentEditingItem ? 'updated' : 'added') + ' by admin</span></div>');
                    $log.scrollTop($log[0].scrollHeight);
                } else {
                    $('#timetableForm')[0].reportValidity();
                }
            });
            
            // Edit user event
            $(document).on('click', '.edit-user', function() {
                const userId = $(this).data('id');
                openEditUserModal(userId);
            });
            
            // Delete user event
            $(document).on('click', '.delete-user', function() {
                const userId = $(this).data('id');
                prepareDelete(userId, 'user');
            });
            
            // Edit bus event
            $(document).on('click', '.edit-bus', function() {
                const busId = $(this).data('id');
                openEditBusModal(busId);
            });
            
            // Delete bus event
            $(document).on('click', '.delete-bus', function() {
                const busId = $(this).data('id');
                prepareDelete(busId, 'bus');
            });
            
            // Edit route event
            $(document).on('click', '.edit-route', function() {
                const routeId = $(this).data('id');
                openEditRouteModal(routeId);
            });
            
            // Delete route event
            $(document).on('click', '.delete-route', function() {
                const routeId = $(this).data('id');
                prepareDelete(routeId, 'route');
            });
            
            // Edit timetable event
            $(document).on('click', '.edit-timetable', function() {
                const timetableId = $(this).data('id');
                openEditTimetableModal(timetableId);
            });
            
            // Delete timetable event
            $(document).on('click', '.delete-timetable', function() {
                const timetableId = $(this).data('id');
                prepareDelete(timetableId, 'timetable');
            });
            
            // Confirm delete
            $('#confirmDelete').click(function() {
                confirmDelete();
            });
            
            // Initialize tooltips
            $('[data-bs-toggle="tooltip"]').tooltip();
            
            // Simulate dynamic system stats
            setInterval(function() {
                // Randomly update stats for demo purposes
                $('#cpu-usage').text(Math.floor(Math.random() * 30 + 30) + '%');
                $('#memory-usage').text(Math.floor(Math.random() * 20 + 60) + '%');
                
                // Update progress bars
                $('.progress-bar').each(function() {
                    const value = parseInt($(this).parent().next().text());
                    $(this).css('width', value + '%');
                });
            }, 5000);
        });
    </script>
</body>
</html>